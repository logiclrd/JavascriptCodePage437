<html>
	<head>
		<script src="cp437.js"></script>
		<script src="mapcache.js"></script>
		<style type="text/css">
			@font-face
			{
				font-family: 'Perfect DOS VGA 437';
				src: local('Perfect DOS VGA 437'), local('PerfectDOSVGA437'),
					url('PerfectDOSVGA437.woff2') format('woff2'),
					url('PerfectDOSVGA437.woff') format('woff');
				font-weight: normal;
				font-style: normal;
				font-display: swap;
			}

			@font-face
			{
				font-family: 'Perfect DOS VGA 437 Complete';
				src: local('Perfect DOS VGA 437 Complete'), local('PerfectDOSVGA437Complete'),
					url('PerfectDOSVGA437Complete.woff2') format('woff2'),
					url('PerfectDOSVGA437Complete.woff') format('woff');
				font-weight: normal;
				font-style: normal;
				font-display: swap;
			}

			.DOSFont
			{
				background: #DDD;
				border: 1px solid #004;
				padding: 2px;
				font-family: 'Perfect DOS VGA 437 Complete';
				letter-spacing: calc(-1em / 16); /* convert 9x16 to 8x16 */
			}
		</style>
		<script type="text/javascript">
			window.onload =
				function()
				{
					var lstSuggestions = document.getElementById("lstSuggestions");
					var txtInput = document.getElementById("txtInput");
					var cmdTranslate = document.getElementById("cmdTranslate");
					var lblDefaultFont = document.getElementById("lblDefaultFont");
					var lblUntranslated = document.getElementById("lblUntranslated");
					var lblTranslated = document.getElementById("lblTranslated");

					var lblAction = document.getElementById("lblAction");
					var lblCacheRecent = document.getElementById("lblCacheRecent");
					var lblCachePreCache = document.getElementById("lblCachePreCache");
					var lblCacheCached = document.getElementById("lblCacheCached");

					lstSuggestions.onchange =
						function()
						{
							txtInput.value = lstSuggestions.options[lstSuggestions.selectedIndex].value;
						};

					var didConvert;

					var detectConvert =
						function (str)
						{
							didConvert = true;
							return ConvertUnicodeToCP437(str);
						};

					var mapCache = new MapCache(detectConvert);

					cmdTranslate.onclick =
						function()
						{
							var text = txtInput.value;

							didConvert = false;

							var translated = mapCache.Map(text);

							translated = translated.replaceAll("\u000A", "␤").replaceAll("\u000D", "␍");

							lblDefaultFont.innerText = text;
							lblUntranslated.innerText = text;
							lblTranslated.innerText = translated;

							if (didConvert)
							{
								lblAction.innerText = "String was converted";
								lblAction.style.color = "brown";
							}
							else
							{
								lblAction.innerText = "Cached conversion was used";
								lblAction.style.color = "green";
							}

							var cacheStats = mapCache.GetCacheStatistics();

							lblCacheRecent.innerText = cacheStats.Recent;
							lblCachePreCache.innerText = cacheStats.PreCache;
							lblCacheCached.innerText = cacheStats.Cached;
						};
				};
		</script>
	</head>
	<body>
		<select id="lstSuggestions">
			<option>├──────────────────────────────── Immediate ─────────────────────────────────┬┤</option>
			<option>┌──────────────────────────────── Untitled ─────────────────────────────────↑─┐</option>
			<option>☺☻♥♦♣♠●◘○◙♂♀♪♬✵⯈⯇↕‼¶§▬↨↑↓	→←∟↔⯅⯆</option>
			<option>ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑ</option>
			<option>░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀</option>
			<option>αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■</option>
		</select>
		<br />
		Input: <input id="txtInput" type="text" value="Type text here or select from the drop-down above" size="100" /><br />
		<input id="cmdTranslate" type="button" value="Translate" /><br />
		<hr />
		<table style="border: none">
			<tr>
				<td>
					Default font:
				</td>
				<td>
					<span id="lblDefaultFont"></span><br />
				</td>
			</tr>
			<tr>
				<td>
					In 437 font untranslated:
				</td>
				<td>
					<span id="lblUntranslated" class="DOSFont"></span><br />
				</td>
			</tr>
			<tr>
				<td>
					In 437 font translated:
				</td>
				<td>
					<span id="lblTranslated" class="DOSFont"></span><br />
				</td>
			</tr>
		</table>
		<br />
		<span id="lblAction">Nothing has been translated yet</span><br />
		<br />
		<span>Cache statistics:</span><br />
		<ul>
			<li>Recent: <span id="lblCacheRecent"></span></li>
			<li>Candidates for promotion to permanent: <span id="lblCachePreCache"></span></li>
			<li>Permanently cached: <span id="lblCacheCached"></span></li>
		</ul>
	</body>
</html>